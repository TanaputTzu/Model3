<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <title>AR Model Viewer</title>

    <!-- model-viewer -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background: #fafafa;
            text-align: center;
        }
        #infoBox {
            width: 320px;
            margin: 30px auto;
            padding: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            text-align: left;
        }
        pre {
            background: #f3f3f3;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>

<body>

<h2>ทดสอบคลิก Model</h2>

<!-- ====================== MODEL VIEWER ====================== -->
<model-viewer id="viewer"
    src="https://modelagency.pw/ggaa_ZZ.glb"
    camera-controls
    auto-rotate
    exposure="1"
    shadow-intensity="1"
    ar
    style="width: 80vw; height: 60vh; margin: auto; background:#ddd;">
</model-viewer>

<!-- แสดงผล -->
<div id="infoBox">
    <strong id="hitTitle">ยังไม่ได้คลิกโมเดล</strong>
    <pre id="hitData">{}</pre>
</div>

<script>
    const viewer = document.querySelector("#viewer");
    const hitTitle = document.querySelector("#hitTitle");
    const hitData = document.querySelector("#hitData");

    // เมื่อโหลดโมเดลเสร็จ
    viewer.addEventListener("load", () => {
        console.log("MODEL LOADED");
    });

    // คลิกโมเดล
    viewer.addEventListener("click", (event) => {
        console.log("CLICK DETECTED");

        const rect = viewer.getBoundingClientRect();
        const x = (event.clientX - rect.left) / rect.width;
        const y = (event.clientY - rect.top) / rect.height;

        const hit = viewer.positionAndNormalFromPoint(x, y);

        if (!hit) {
            console.log("HIT RESULT: null");
            hitTitle.textContent = "No Hit";
            hitData.textContent = JSON.stringify({
                Error: "ไม่ได้แตะโดนโมเดลหรือไม่มีข้อมูล"
            }, null, 2);
            return;
        }

        console.log("HIT RESULT:", hit);

        hitTitle.textContent = "Hit OK!";
        hitData.textContent = JSON.stringify(hit, null, 2);
    });
</script>

</body>
</html>
