<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤</title>

  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <script type="module" src="https://unpkg.com/three@0.152.2/build/three.module.js"></script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      background: #fafafa;
    }
    #infoBox {
      margin-top: 20px;
      padding: 15px;
      width: 350px;
      background: white;
      box-shadow: 0px 2px 10px rgba(0,0,0,0.15);
      border-radius: 10px;
      display: inline-block;
      text-align: left;
    }
  </style>
</head>

<body>

  <h2>‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤</h2>

  <model-viewer id="viewer"
    src="https://modelagency.pw/ggaa_ZZ.glb"
    camera-controls
    touch-action="none"
    exposure="1"
    disable-zoom
    style="width: 800px; height: 500px; background:#ddd; border-radius:15px;">
  </model-viewer>

  <div id="infoBox">
    <b>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</b>
    <pre id="output">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•</pre>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.152.2/build/three.module.js";

    const viewer = document.getElementById("viewer");
    const output = document.getElementById("output");

    viewer.addEventListener("load", () => {
      console.log("MODEL LOADED");
    });

    // üëâ Raycaster
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    viewer.addEventListener("click", (event) => {
      console.log("CLICK DETECTED");

      const rect = viewer.getBoundingClientRect();
      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

      const camera = viewer.getCamera();     // ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á model-viewer
      const scene = viewer.model?.scene;     // ‡πÇ‡∏°‡πÄ‡∏î‡∏• (Three.js Scene)

      if (!scene) {
        output.innerText = "‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à";
        return;
      }

      raycaster.setFromCamera(mouse, camera);

      const intersects = raycaster.intersectObjects(scene.children, true);

      if (intersects.length === 0) {
        console.log("NOT HIT");
        output.innerText = "‡πÑ‡∏°‡πà‡πÇ‡∏î‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•";
        return;
      }

      const hit = intersects[0];

      output.innerText = JSON.stringify(
        {
          point: hit.point,
          normal: hit.face?.normal,
          object: hit.object.name
        },
        null,
        2
      );
    });
  </script>

</body>
</html>
