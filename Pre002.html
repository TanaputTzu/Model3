<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ห้องปฏิบัติการประชุมของสาขา</title>

  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <script type="module" src="https://unpkg.com/three@0.152.2/build/three.module.js"></script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      background: #fafafa;
    }
    #infoBox {
      margin-top: 20px;
      padding: 15px;
      width: 350px;
      background: white;
      box-shadow: 0px 2px 10px rgba(0,0,0,0.10);
      border-radius: 10px;
      display: inline-block;
      text-align: left;
    }
  </style>
</head>

<body>

  <h2>ห้องปฏิบัติการประชุมของสาขา</h2>

  <model-viewer id="viewer"
    src="https://modelagency.pw/ggaa_ZZ.glb"
    camera-controls
    touch-action="none"
    exposure="1"
    disable-zoom
    style="width: 800px; height: 500px; background:#ddd; border-radius:15px;">
  </model-viewer>

  <div id="infoBox">
    <b>ผลลัพธ์:</b>
    <pre id="output">ยังไม่ได้คลิกโมเดล</pre>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.152.2/build/three.module.js";

    const viewer = document.querySelector("#viewer");
    const output = document.querySelector("#output");

    // ดึง symbol THREE ที่ซ่อนไว้ใน model-viewer
    const $renderer = Object.getOwnPropertySymbols(viewer)
      .find(s => viewer[s]?.renderer);

    viewer.addEventListener("load", () => {
      console.log("MODEL LOADED");
    });

    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    viewer.addEventListener("click", (event) => {
      console.log("CLICK DETECTED");

      const rect = viewer.getBoundingClientRect();
      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

      const rendererData = viewer[$renderer];
      if (!rendererData) {
        output.innerText = "ไม่พบ renderer ภายในของ model-viewer";
        return;
      }

      const threeScene = rendererData.scene;
      const threeCamera = rendererData.camera;

      raycaster.setFromCamera(mouse, threeCamera);

      const intersects = raycaster.intersectObjects(threeScene.children, true);

      if (intersects.length === 0) {
        output.innerText = "ไม่โดนโมเดล";
        return;
      }

      const hit = intersects[0];

      output.innerText = JSON.stringify(
        {
          point: hit.point,
          normal: hit.face?.normal,
          object: hit.object.name
        }
